{#
 # News Archive Template
 # -------------------
 #}

{# Define a Entry Var - otherwise you get Errors on Channel Pages #}
{% set myentry = {
  'slug': 'news'
} %}

{% extends '_layout/main-layout.html' %}

{% block content %}
  <div class="o-layout__container">
    <h1>{{ myentry.slug }}</h1>

    {# Build Query #}
    {% set entries = craft.entries({
      section: myentry.slug,
      sort: 'postDate',
      relatedTo: (category is defined ? category : false),
      limit: 10
    }) %}
    {# Initiate the Pagination #}
    {% paginate entries as pageInfo, pageEntries %}
    {# Cache Entry #}
    {% cache globally using key myentry.slug~'archives' %}
      {# Loop through entries #}
      {% for entry in pageEntries %}
        <article role="article" itemscope itemtype="http://schema.org/Article">
          <p>{{ entry.postDate.format('d.F Y') }}</p>
          <h2 role="heading" itemprop="name"><a href="{{ entry.url }}" role="link" itemprop="contentUrl">{{ entry.title }}</a></h2>
          {{ entry.body.getPage(1) }}
          <p><a href="{{ entry.url }}" role="link">Weiterlesen</a></p>
        </article>
      {% endfor %}
    {% endcache %}
    {# Include Pagination #}
    {{ myMacro.pagination(pageInfo,craft) }}
  </div>
{% endblock %}
