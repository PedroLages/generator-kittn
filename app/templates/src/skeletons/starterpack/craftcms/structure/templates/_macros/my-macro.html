{#
  Macro Collection
  ================
#}

{# ===================================================== #}
{# ---------------- Internal Macros -------------------- #}
{# ===================================================== #}

{#
  AmNav Builder
  =============
  Needed for SiteNavigation with Am Nav

  @private
#}
{% macro addNodeToNavigation(node, index) %}
  {%- set nodeClasses = [] -%}
  {%- if node.hasChildren -%}
    {%- set nodeClasses = nodeClasses|merge(['has-children']) -%}
  {%- endif -%}
  {%- if node.active or node.hasActiveChild -%}
    {%- set nodeClasses = nodeClasses|merge(['is-active']) -%}
  {%- endif -%}
  {%- if node.level == 1 and index == 1 -%}
    {%- set nodeClasses = nodeClasses|merge(['first']) -%}
  {%- endif -%}
  {%- if node.listClass|length -%}
    {%- set nodeClasses = nodeClasses|merge([node.listClass]) -%}
  {%- endif -%}

  <a href="{{ node.url }}" role="link" {% if nodeClasses|length %} class="{{ nodeClasses|join(' ') }}"{% endif %} title="{{ node.name }}"{% if node.blank %}  target="_blank"{% endif %}>{{ node.name }}</a>
{% endmacro %}


{# ===================================================== #}
{# ----------------- Regular Macros -------------------- #}
{# ===================================================== #}

{#
  Media Image Set
  ===============
  Build a Image Element as regular `<img>` or fill a element with a background image.

  @param {array}  photo               = Image Array
  @param {string} imageratio          = Optional Imageratio [nocrop, '16:6', '1:1'...]
  @param {object} options             = Array of options
  @param {string} options.class       = Classname from the Element
  @param {bool}   options.background  = Background Option
  @param {string} options.elementtype = Typedefinition from Background Image Element
  @param {number} options.quality     = JPEG Compression
#}
{% macro mediaImageSet(photo,imageratio,options) %}

  {# Default Values - can be overwritten #}
  {% set opt = {
    class: 'o-media-object__image',
    background: false,
    elementtype: 'figure',
    quality: 82
  } %}

  {# Merge our two arrays together #}
  {% set options = opt|merge(options) %}

  {# Check if Image is Available otherwise use a neutral Placeholder #}
  {% if photo %}
    {# Check if image would cropped#}
    {% if imageratio != 'nocrop' %}
      {# Transform Image Ratio in a Array #}
      {% set ratio = imageratio|default('35:24')|split(':') %}
      {# Set Focal Point #}
      {% set focusPosition = photo.focalpoint is defined ? photo.focalpoint : '50% 50%' %}
      {# Define the Modifier for Imager#}
      {% set globalModifier = { jpegQuality: options.quality, ratio: ratio|first/ratio|last , mode: 'crop', position: focusPosition } %}
    {% else %}
      {# Define the Modifier for Imager#}
      {% set globalModifier = { jpegQuality: options.quality } %}
    {% endif %}

    {# Build the Image Set #}
    {% set photos = craft.imager.transformImage(photo,
      [
        { width: 1900 },
        { width: 1200 },
        { width: 800 },
        { width: 500 },
        { width: 320 },
        { width: 150 },
        { width: 30, effects: { blur: 3 } }
      ], globalModifier)
    %}

    {# Output as <img> or Background #}
    {% if (options.background) %}
      <{{ options.elementtype }} class="{{ options.class }} lazyload" style="background-image: url({{ photos|last.url }})" data-sizes="auto" data-bgset="{{ craft.imager.srcset( photos ) }}"></{{ options.elementtype }}>
    {% else %}
      <img class="{{ options.class }} lazyload" data-sizes="auto" src="{{ photos|last.url }}" data-srcset="{{ craft.imager.srcset( photos ) }}" role="img" {% if photo.title %}alt="{{ photo.title }}"{% endif %} itemprop="thumbnail">
    {% endif %}
  {% endif %}
{% endmacro %}

{#
  Pagination
  ==========
  Generate navigation buttons for paginations

  @param {object}  pages       - Pagination Object
  @param {object}  craft       - Craft Request Object
  @param {string}  class       - Classname (default: 'pagination')
  @param {string}  searchquery - To pass search words from Searchfields (default: false)
#}
{% macro pagination(pages,craft,class,searchquery) %}
  {% set search = searchquery|default(false) %}
  {% set class = classname|default('o-pagination') %}

  {# Add Pagination only if the Page Number is higher than 1#}
  {% if pages.totalPages > 1 %}

    <nav class="{{ classname }}" role="navigation">
      {# Dont display last page when on the first Page #}
      {% if pages.currentPage > 2 and pages.prevUrl %}
        <a class="{{ classname }}__link---text" href="{{ pages.firstUrl }}{{ search ? '?q='~search }}" title="Zur ersten Seite">
          &laquo;
        </a>
      {% endif %}

      {# Display the Previous Link if available #}
      {% if pages.prevUrl %}
        <a class="{{ classname }}__link---text" href="{{ pages.prevUrl }}{{ search ? '?q='~search }}" title="Zurück zur vorhergehenden Seite">
          &lsaquo;
        </a>
      {% endif %}

      {# Display prev 5 Page Links#}
      {% for page, url in pages.getPrevUrls(5) %}
        <a class="{{ classname }}__link---number" href="{{ url }}{{ search ? '?q='~search }}" title="Sprung zur Seite {{ page }}">
          {{ page }}
        </a>
      {% endfor %}

      {# Diplay Current Page#}
      <span class="{{ classname }}__link---current">
        {{ pages.currentPage }}
      </span>

      {# Display next 5 Page Links #}
      {% for page, url in pages.getNextUrls(5) %}
        <a class="{{ classname }}__link---number" href="{{ url }}{{ search ? '?q='~search }}" title="Sprung zur Seite {{ page }}">
          {{ page }}
        </a>
      {% endfor %}

      {# Display next Page Link if available#}
      {% if pages.nextUrl %}
        <a class="{{ classname }}__link---text" href="{{ pages.nextUrl }}{{ search ? '?q='~search }}" title="Weiter zur nächsten Seite">
          &rsaquo;
        </a>
      {% endif %}

      {# Dont display when on the last page #}
      {% if (pages.totalPages - 1) > pages.currentPage and pages.totalPages > 2 %}
        <a class="{{ classname }}__link---text" href="{{ pages.lastUrl }}{{ search ? '?q='~search }}" title="Zur letzten Seite">
          &raquo;
        </a>
      {% endif %}
    </nav>
  {% endif %}
{% endmacro %}

{#
  Site Navigation
  ===============
#}
{% macro siteNavigation(classname,sectionPart) %}
  {% set class = classname|default('o-navigation') %}

  <nav class="{{ classname }}" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
    {% switch sectionPart %}
      {% case 'footernav' %}
        {% set nav = craft.amNav.getNavRaw('footerNavigation') %}
      {% case 'mainnav' %}
        {% set nav = craft.amNav.getNavRaw('mainNavigation') %}
    {% endswitch %}

    {% for node in nav %}
      {{ _self.addNodeToNavigation(node, loop.index) }}
    {% endfor %}
  </nav>
{% endmacro %}

{#
  Social Share Macro
  ==================
  Works with SeoMatic

  @param {object} networks = Possible Social Networks
  @param {bool}   networks.facebook
  @param {bool}   networks.twitter
  @param {bool}   networks.googleplus
  @param {bool}   networks.pinterest
  @param {bool}   networks.mail
  @param {bool}   networks.whatsapp

  @param {object} options     = Config Options
  @param {string} class       = Classname
  @param {*}      request     = Request URL
  @param {*}      description = Seo Description
  @param {*}      image       = Seo Image URL
  @param {*}      title       = Seo Title
  @param {bool}   icon        = Option that activate SVG Share Icons
  @param {string} iconpath    = Path to icons
  @param {string} iconname    = Iconfile Name (Sprite)
  @param {string} iconprefix  = Prefix for icons
  @param {string} viewbox     = Viewbox Size
#}
{% macro socialShare(networks, options) %}
  {% set opt = {
    'class': 'o-socialshare',
    'request': craft.request.url,
    'description': seomaticMeta.seoDescription,
    'image': seomaticMeta.seoImage,
    'title': seomaticMeta.seoTitle,
    'icon': true,
    'iconpath': '/assets/img/',
    'iconname': 'symbol-sprite.svg',
    'iconprefix': 'icon-',
    'viewbox': '0 0 20 20'
  } %}

  {# Second Default Array for Networks, because recursive mer#}
  {% set net = {
    'facebook': true,
    'twitter': true,
    'googleplus': true,
    'pinterest': true,
    'mail': true,
    'whatsapp': false
  } %}

  {# Merge Options with Defaults #}
  {% set options = opt|merge(options) %}
  {% set networks = net|merge(networks) %}

  {# Build Share URLs #}
  {% set shareUrl = {
    'facebook': 'http://www.facebook.com/sharer.php?u='~options.request,
    'twitter': 'http://twitter.com/share?url='~options.request~'&amp;text='~options.description,
    'googleplus': 'https://plus.google.com/share?url='~options.request,
    'pinterest': '//pinterest.com/pin/create/link/?url='~options.request~'&amp;media='~options.image~'&amp;description='~options.description|e,
    'mail': 'mailto:?Subject='~options.title~'&Body=%20'~options.request,
    'whatsapp': 'whatsapp://send?text='~options.request~' '~options.description
  } %}

  {# Building Block - Modify structure if needed #}
  <nav role="navigation" class="{{ options.class }}">
    {% for key, network in networks if network != false %}
      {% if options.icon == true %}<div class="{{ options.class }}__box">{% endif %}
      <a href="{{ shareUrl[key] }}" target="_blank" class="{{ options.class }}__link" title="Share with {{ key|capitalize }}">
        {% if options.icon == true %}
          <svg class="{{ options.class }}__icon" viewBox="{{ options.viewbox }}">
            <use xlink:href="{{ options.iconpath }}{{ options.iconname }}#{{ options.iconprefix}}{{ key }}"></use>
          </svg>
        {% else %}
          {{ key }}
        {% endif %}
      </a>
      {% if options.icon == true %}</div>{% endif %}
    {% endfor %}
  </nav>
{% endmacro %}


{#
  Social Link Macro
  ==================
  Simple Links to the Social Network Fanpages

  @param {object} options     = Config Options
  @param {string} class       = Classname
  @param {bool}   icon        = Option that activate SVG Share Icons
  @param {string} iconpath    = Path to icons
  @param {string} iconname    = Iconfile Name (Sprite)
  @param {string} iconprefix  = Prefix for icons
  @param {string} viewbox     = Viewbox Size
  @param {object} links       = A Array with Linkentries
#}
{% macro socialLink(options, links) %}
  {# Set Links to the Default Field #}
  {% if main.socialLinks is defined %}
    {% set links = links|default(main.socialLinks) %}
  {% endif %}

  {% set opt = {
    'class': 'o-sociallink',
    'icon': true,
    'iconpath': '/assets/img/',
    'iconname': 'symbol-sprite.svg',
    'iconprefix': 'icon-',
    'viewbox': '0 0 20 20'
  } %}

  {# Merge Options with Defaults #}
  {% set options = opt|merge(options) %}

  {# Building Block - Modify structure if needed #}
  <nav role="navigation" class="{{ options.class }}">
    {% for link in links  %}
      {% if options.icon == true %}<div class="{{ options.class }}__box">{% endif %}
      <a href="{{ link.socialLink }}" target="_blank" class="{{ options.class }}__link" title="Share with {{ link.socialTitle }}">
        {% if options.icon == true %}
          <svg class="{{ options.class }}__icon" viewBox="{{ options.viewbox }}">
            <use xlink:href="{{ options.iconpath }}{{ options.iconname }}#{{ options.iconprefix }}{{ link.socialIcon }}"></use>
          </svg>
        {% else %}
          {{  link.socialIcon }}
        {% endif %}
      </a>
      {% if options.icon == true %}</div>{% endif %}
    {% endfor %}
  </nav>
{% endmacro %}


{#
  SVGIcon
  =======
  Insert SVG Icons in a easy way

  @param {string} icon                = Iconname
  @param {object} options             = Config Options
  @param {string} options.class       = Optional Classname
  @param {string} options.iconpath    = Path to icons
  @param {string} options.iconname    = Iconfile Name (Sprite)
  @param {string} options.iconprefix  = Prefix for icons
  @param {string} options.viewbox     = Viewbox Size
#}
{% macro svgicon(icon, options = {}) %}
  {% set opt = {
    'class': false,
    'iconpath': '/assets/img/',
    'iconname': 'symbol-sprite.svg',
    'iconprefix': 'icon-',
    'viewbox': '0 0 20 20'
  } %}

  {# Merge Options with Defaults #}
  {% set options = opt|merge(options) %}

  {# Building Block - Modify structure if needed #}
  <svg{{ options.class ? ' class='~options.class }} viewBox="{{ options.viewbox }}">
    <use xlink:href="{{ options.iconpath }}{{ options.iconname }}#{{ options.iconprefix }}{{ icon }}"></use>
  </svg>
{% endmacro %}
